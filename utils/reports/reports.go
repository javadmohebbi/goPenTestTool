package reports

import (
	"fmt"
	"os"
	"strings"
	"time"
)

// struct for creating reports
type Reports struct {
	filePath string

	f *os.File
}

// create new instance of reports
func New(filepath string) (*Reports, error) {

	t := time.Now()

	var fil, ext string = "", ""
	splited := strings.Split(filepath, ".")
	if len(splited) >= 2 {
		for i := 0; i < len(splited)-1; i++ {
			fil = splited[i]
		}
		ext = "." + splited[len(splited)-1]
	} else {
		fil = filepath
		ext = ""
	}
	fil += "_rpt_"

	f, err := os.Create(fil + t.Format("20060102-15-04-05") + ext)
	if err != nil {
		return &Reports{}, err
	}

	return &Reports{
		filePath: filepath,
		f:        f,
	}, nil
}

// Write new line to the report file & append '\n' to end of the line
// it returns number of writen bytes and error (if has)
func (r *Reports) WriteLine(line string) (int, error) {
	return r.f.WriteString(fmt.Sprintf("%s\n", line))
}

// close file
func (r *Reports) Close() error {
	return r.f.Close()
}
