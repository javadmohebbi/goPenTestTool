package grabber

import (
	"fmt"
	"strings"
)

// interface to define grabber
type Grabber interface {
	// Grab Banners
	Grab() error

	// Print Info
	Print()

	// Write info to file
	WriteToFile()
}

// Create New instance of grabber
func New(grm GrabRequest) (Grabber, error) {

	if grm.Target.Port < 1 && grm.Target.Port > 65535 {
		panic(fmt.Sprintf("[Error] port %v is out of range", grm.Target.Port))
	}

	grm.Target.Host = strings.ReplaceAll(grm.Target.Host, "http://", "")
	grm.Target.Host = strings.ReplaceAll(grm.Target.Host, "https://", "")

	switch grm.Type {
	case "http":
		if grm.Target.Port <= 0 {
			grm.Target.Port = 80
		}
		return Grabber(
			&HTTPGrabber{
				GrabRequest: grm,
			},
		), nil
	case "https":
		if grm.Target.Port <= 0 {
			grm.Target.Port = 443
		}
		return Grabber(
			&HTTPGrabber{
				GrabRequest: grm,
			},
		), nil

	default:
		return Grabber(
			&HTTPGrabber{
				GrabRequest: grm,
			},
		), nil
	}
}
